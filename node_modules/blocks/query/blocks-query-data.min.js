!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,!0):b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a,b,d,e,g){if(g!==!1&&(g=!0),a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof l&&(a=a._wrapped),b instanceof l&&(b=b._wrapped);var h=f.call(a);if(h!=f.call(b))return!1;switch(h){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var i=d.length;i--;)if(d[i]==a)return e[i]==b;var j=a.constructor,k=b.constructor;if(j!==k&&!(l.isFunction(j)&&j instanceof j&&l.isFunction(k)&&k instanceof k)&&"constructor"in a&&"constructor"in b)return!1;d.push(a),e.push(b);var m=0,n=!0;if("[object Array]"==h){if(m=a.length,n=m==b.length)for(;m--&&(n=g?c(a[m],b[m],d,e,g):a[m]===b[m]););}else{for(var o in a)if(l.has(a,o)&&(m++,!(n=l.has(b,o)&&(g?c(a[o],b[o],d,e,g):a[o]===b[o]))))break;if(n){for(o in b)if(l.has(b,o)&&!m--)break;n=!m}}return d.pop(),e.pop(),n}function d(a,b){var c,d,e=this.__Class__;return l.isString(a)?d=e.prototype[a]:(b=a,d=e),this.__Class__=e.prototype.__Class__,c=d.apply(this,b||[]),this.__Class__=e,c}function e(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}var f=Object.prototype.toString,g=Array.prototype.slice,h=Object.prototype.hasOwnProperty,j={},k={},l=function(a){return k.expressionsCreated?0===arguments.length?k.staticExpression:k.createExpression(a):a};l.version="0.3.3",l.core=k,l.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||l.isFunction(g)||(g={});i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(l.isPlainObject(c)||(b=l.isArray(c)))?(b?(b=!1,f=a&&l.isArray(a)?a:[]):f=a&&l.isPlainObject(a)?a:{},g[d]=l.extend(j,f,c)):g[d]=c);return g},l.each=function(a,b,c){if(null!=a){var d=a.length,f=-1,g="number"==typeof d;if(b=e(b,c),g)for(;++f<d&&b(a[f],f,a)!==!1;);else for(f in a)if(b(a[f],f,a)===!1)break}},l.eachRight=function(a,b,c){if(null!=a){var d=a.length,f=a.length,g="number"==typeof d;if(b=e(b,c),g)for(;--f>=0;)b(a[f],f,a);else for(f in a)b(a[f],f,a)}},l.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){l["is"+a]=function(b){return f.call(b)=="[object "+a+"]"}}),l.isArguments(arguments)||(l.isArguments=function(a){return!(!a||!h.call(a,"callee"))}),"function"!=typeof/./&&(l.isFunction=function(a){return!(!a||"function"!=typeof a)}),l.isArray=Array.isArray||function(a){return"[object Array]"==f.call(a)},l.extend(l,{noop:function(){},inherit:function(a,b,c){return(arguments.length<3&&l.isPlainObject(b)||1==arguments.length)&&(c=b,b=a,a=void 0),a?(b.prototype=m(a.prototype),b.prototype.constructor=b,l.extend(b.prototype,c),b.prototype.__Class__=a,b.prototype._super=d):c&&(b.prototype=c),b},type:function(a){return a instanceof Array?"array":"string"==typeof a||a instanceof String?"string":"number"==typeof a||a instanceof Number?"number":a instanceof Date?"date":"[object RegExp]"===f.call(a)?"regexp":null===a?"null":void 0===a?"undefined":l.isFunction(a)?"function":l.isBoolean(a)?"boolean":"object"},is:function(a,b){return arguments.length>1&&l.isFunction(b)?b.prototype.isPrototypeOf(a):l.type(a)==b},has:function(a,b){return!(!a||!h.call(a,b))},hasValue:function(a){return!(null==a||l.isNumber(a)&&isNaN(a))},toString:function(a){var b="";return l.hasValue(a)&&(b=a.toString()),b},unwrap:function(a){return k.expressionsCreated&&k.isExpression(a)?a.value():l.unwrapObservable?l.unwrapObservable(a):a},$unwrap:function(a,b,c){return b=e(b,c),a&&a.jquery?(b&&a.each(function(){b(this)}),a=a[0]):b&&b(a),a},toArray:function(a){if(l.isArguments(a))return g.call(a);if(l.isElements(a)){for(var b=Array(a.length),c=-1,d=a.length;++c<d;)b[c]=a[c];return b}return l.isArray(a)?a:[a]},toUnit:function(a,b){var c=b;return b=b||"px",l.isNaN(parseFloat(a))?a:l.isString(a)&&l.isNaN(parseInt(a.charAt(a.length-1),10))?c?a.replace(/[^0-9]+$/,b):a:a+b},clone:function(a,b){if(null==a)return a;var c,d,e=l.type(a);if("array"==e)return a.slice(0);if("object"==e){c=a.constructor===Object?{}:new a.constructor;for(d in a)c[d]=b?l.clone(a[d],!0):a[d];return c}if("date"==e)return new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());if("string"==e)return a.toString();if("regexp"==e){var f="";return a.global&&(f+="g"),a.ignoreCase&&(f+="i"),a.multiline&&(f+="m"),c=new RegExp(a.source,f),c.lastIndex=a.lastIndex,c}return a},isElements:function(a){var b=!1;if(a&&("undefined"!=typeof HTMLCollection&&(b=a instanceof window.HTMLCollection),"undefined"==typeof NodeList||b||(b=a instanceof NodeList),!b&&l.isString(a.item)))try{a.item(0),b=!0}catch(c){}return b},isElement:function(a){return!(!a||1!==a.nodeType)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==f.call(a)},isObject:function(a){return a===Object(a)},isPlainObject:function(a){var b;if(!a||"object"!=typeof a||"[object Object]"!==f.call(a)||a.nodeType||a.window==a)return!1;try{if(a.constructor&&!h.call(a,"constructor")&&!h.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(j.ownPropertiesAreLast)for(b in a)return h.call(a,b);for(b in a);return void 0===b||h.call(a,b)},isFinite:function(a){return isFinite(a)&&!l.isNaN(parseFloat(a))},isNaN:function(a){return l.isNumber(a)&&a!=+a},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a},nothing:{},access:function(a,b,c){var d,e=0;for(c=arguments.length>2?c:l.nothing,b=b.split("."),d=b[0];d;){if(null==a)return c;a=a[d],d=b[++e]}return a},swap:function(a,b,c){var d=a.length;return b>=0&&c>=0&&d>b&&d>c&&(a[b]=a[c]+(a[c]=a[b],0)),a},move:function(a,b,c){return b!=c&&(c>=b&&c++,a.splice(c,0,a[b]),b>c&&b++,a.splice(b,1)),a},bind:function(a,b){var c,d=function(){},e=g.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,e.concat(g.call(arguments)));d.prototype=a.prototype;var f=new d,h=a.apply(f,e.concat(g.call(arguments)));return Object(h)===h?h:f}},equals:function(a,b,d){return a=l.unwrap(a),b=l.unwrap(b),c(a,b,[],[],d)}}),l.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},l.first=function(){return l.first},l.last=function(){return l.last};var m=Object.create||function(a){var b=function(){};return b.prototype=a,new b};for(var n in[j])break;j.ownPropertiesAreLast="0"!=n,function(){!function(){function a(a,b){this._value=a,this._computedValue=void 0,b&&(this._parent=b,this._currentResult=l.isBoolean(b._result)?b._result:b._currentResult,this._lastCondition=b._condition||b._lastCondition,this._hasNot=b._hasNot)}function b(a,b,c,d){c=I.parseCallback(c,d)||c;for(var e,f,g={},h=0,i=b.length,j=l.isFunction(c),k=null!=c;i>h;h++)e=b[h],f=k?j?c(e,h,b):e[c]:e,a(g,f,e,b,c);return g}function c(b,e,f,g,h){var i=O.expressions({isRoot:h,name:b,path:e,descriptorName:f||"a",args:(y[f]||{}).args,methods:y,type:g||0,staticMethods:D}),j=new Function(["blocks","blox","expressions","cache","BaseExpression","LoopDescriptors","generateExpression","descriptors","createExpression","PrepareValues","slice","add","NumberExpression"],i)(l,l,Q,P,a,O,c,R,t,I,E,d,n);return h&&(Q[b+"Expression"]=j),j.prototype.forEach=j.prototype.each,j}function d(a,b){if(b.length>0){var c=x.determineIndex(b[0],a.length),d=E.call(b,x.isPosition(b[0])?1:0),e=0;if(c>=a.length)for(;e<d.length;e++)a[c+e]=d[e];else a.splice.apply(a,[c,0].concat(d))}return a}function e(a,b){return d(a,l.flatten(b,!0))}function g(a,b){this.__Class__(a,b)}function h(a,b){for(var c,d=0;d<b.length;d++)c=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(c,b[d]);return a}function j(a,b){this.__Class__(a,b)}function k(a,b){return function(){return a.apply(this,b.concat(E.call(arguments)))}}function m(a,b,c){return b=b||0,setTimeout(function(){return a.apply(null,c)},b)}function n(a,b){this.__Class__(a,b)}function o(a,b){this.__Class__(a,b)}function p(a,b){this.__Class__(a,b)}function q(a){return function(){var b=l.unwrap(this._value||this.data||this);return l[a]?l.unwrap(l[a].apply(b,[b].concat(l.toArray(arguments)))):(b=l(b),b=b[a].apply(b,l.toArray(arguments)),b.result()||b.value())}}function r(){return{indexOrKey:"indexOrKey",length:"length",result:"result",isCollectionAnArray:"isCollectionAnArray",collection:"collection",expression:"expression",value:"value",resultIndex:0,isArrayCheck:'typeof length == "number"',skip:0,take:null,args:[],variables:[],objectBeforeLoops:[],arrayBeforeLoops:[],objectInLoops:[],arrayInLoops:[],objectAfterLoops:[],arrayAfterLoops:[],conditionsEnd:""}}function s(){var a,b={result:"result",inLoop:!0,items:[]},c=0,d=b.items,e=[],f=0;return{callback:function(g){var h=!0;switch(g.name){case"and":d.push(" && ");break;case"or":d.push(" || ");break;case"not":a===!1&&(b.inLoop=!1),a=void 0,d.splice(d.length-1,0,"!"),f++;break;default:h=!1,void 0!==g.boolResult&&(void 0!==a&&a===!0&&(b.inLoop=!1),a=g.boolResult,f++,d.push(b.result+c),g.inLoop=(g.inLoop||"").replace(/(\s|;)(break\s?;)/g,function(a){var b="";return";"==a[0]&&(b=";"),b})),e.push(l.format("var {0}{1};",b.result,c))}return c++,h},end:function(c){void 0!==a&&a===!0&&(b.inLoop=!1),c.conditionsDeclarations=e.join(""),f>1&&(c.conditions=!0,c[(b.inLoop?"inLoop":"afterLoop")+"Conditions"]=O.conditions(b),b.inLoop&&(b.inLoop=!1,c.afterLoopConditions=O.conditions(b)))}}}function t(a){for(var b,c,d=r(),e=a._isSingle,f=a._type,g=e?["array","object"]:[1==a._type?"array":"object"],h=e?"":0,i=[],j=e?void 0:s(),k=0,m=0,n=!1,o="",p=!0;a._parent;)l.each(g,function(c,f){switch("filter"==a._descriptor.identity&&(d.skip&&(o+=O.skip({index:k})),null!==d.take&&(o+=O.take({index:m})),d.skip=0,d.take=null),b=a._descriptor(h,c,a,i,o),o="",0===f&&d.args.push(b.args||[]),b.name){case"skip":return void(d.skip||(d.skip="skip"+h));case"take":return void(null===d.take&&(d.take="take"+h));case"reverse":return void(d.reverse=!d.reverse)}p=!1,(e||!j.callback(b))&&(0===f&&b.reverse&&(d.reverse=!d.reverse),e||(c="array"),void 0!==b.boolResult?d.resultIndex=h||0:h||(n=!0),b.beforeLoop&&d[c+"BeforeLoops"].push(b.beforeLoop),b.inLoop&&d[c+"InLoops"].push(b.inLoop),b.afterLoop&&d[c+"AfterLoops"].push(b.afterLoop))}),"skip"!=b.name&&"take"!=b.name&&"reverse"!=b.name?i.push(a):0==i.length&&(d.resultIndex+=1,"skip"==b.name?k=k||h:m=m||h),h=+h+1,a=a._parent;if(d.isObject=T.prototype.isPrototypeOf(a),e){switch(f){case"array":d.isArrayCheck=!0;break;case"object":d.isArrayCheck=!1}return"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks","collection"].concat(d.args[0]),a._loopDescriptor(d)),function(){return c.apply(this,[l].concat(l.toArray(arguments)))}):new Function(["collection"].concat(d.args[0]),a._loopDescriptor(d))}return j.end(d),p&&(d.arrayBeforeLoops.push(d.result+d.resultIndex+" = [];"),d.arrayInLoops.push(d.result+d.resultIndex+".push("+d.value+");")),n&&(d.resultIndex=0),"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks",d.expression],a._loopDescriptor(d)),function(a){return c(l,a)}):new Function(d.expression,a._loopDescriptor(d))}function u(a){var b={_loopDescriptor:O[a.identity]||O.singleExpression},c={_parent:b,_descriptor:a,_isSingle:!0,_type:a.parent.type};return c}function v(a){var b=Z[a];if(l.isFunction(b)){var c=u(b);if(l[a])return t(c);l[a]=t(c)}}var w=l.at;l.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},l.first=function(){return l.first},l.last=function(){return l.last};var x={isPosition:function(a){return a==l.first||a==l.last||a&&"__blocks.at__"==a.prototypeIndentification},determineIndex:function(a,b){return a==l.first?0:"__blocks.at__"==a.prototypeIndentification?a.index:b}},y={};a.prototype={_prototypeIndentification:"__blocks.expression__",_expression:a,type:function(){return"base"},is:function(a){return this._setResult(l.is(this._value,a)),this},value:function(){return this._value},not:function(){var a=new this._expression(this._value,this);return a._hasNot=!this._hasNot,a},or:function(){var a=new this._expression(this._value,this);return a._condition="or",a},and:function(){var a=new this._expression(this._value,this);return a._condition="and",a},result:function(){return this._not?!this._result:this._result},each:function(){},equals:function(a,b){var c=new this._expression(this._value,this);return c._setResult(l.equals(this._value,a,b)),c},hasValue:function(){return this._resultExpression(l.hasValue(this._value))},toString:function(){return new g(l.toString(this._value))},toArray:function(){return new S(l.toArray(this.value()))},clone:function(a){return l(l.clone(this._value,a))},_setResult:function(a){switch(this._hasNot&&(a=!a),this._lastCondition){case"and":this._result=this._currentResult&&a;break;case"or":this._result=this._currentResult||a;break;default:this._result=a}this._hasNot=!1,this._lastCondition=void 0},_resultExpression:function(a){var b=new this._expression(this._value,this);return b._setResult(a),b}},l.extend(l,{isEmpty:function(a){if(null==a)return!0;if(l.isArray(a)||l.isString(a)||l.isArguments(a))return!a.length;for(var b in a)return l.has(a,b)?!1:!0;return!0}});var z=function(a){return a},A=Object.prototype.hasOwnProperty,B=Math.max,C=Math.ceil;l.extend(l,{range:function(a,b,c){tart=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=B(0,C((b-a)/(c||1))),f=Array(e);++d<e;)f[d]=a,a+=c;return f},groupBy:function(a,c,d){return b(function(a,b,c){A.call(a,b)||(a[b]=[]),a[b].push(c)},a,c,d)},countBy:function(a,c,d){return b(function(a,b){A.call(a,b)||(a[b]=0),a[b]++},a,c,d)},sortBy:function(a,b,c){var d,e,f,g,h,j=b?b.length:0;return l.isPlainObject(b)&&(b=[b],j=1),l.isArray(b)?j>0?a.sort(function(a,c){for(i=0;i<j;i++)if(e=b[i],d=e.dir?e.dir.toLowerCase():"asc","none"!=d&&(g=a[e.field],h=c[e.field],g!==h))return f=g>h?1:-1,"desc"==d?-f:f}):a:(b=I.parseCallback(b,c),b||(b=z),l(a).map(function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){if(g=a.criteria,h=b.criteria,g!==h){if(g>h||void 0===g)return 1;if(h>g||void 0===h)return-1}return a.index-b.index}).map("value").value())}});var D={},E=Array.prototype.slice,F={skip:function(){return{name:"skip",args:["skip"]}},take:function(){return{name:"take",args:["take"]}},and:function(){return{name:"and",args:[]}},or:function(){return{name:"or",args:[]}},not:function(){return{name:"not",args:[]}},reverse:function(){return{name:"reverse",args:[]}}};for(var G in F)F[G].identity=G;var H=l.core,I={parseCallback:function(a,b){if("string"==typeof a){var c=a;return function(a){return a[c]}}if(null!=b){var d=a;a=function(a,c,e){return d.call(b,a,c,e)}}return a},uniquePrepare:function(a,b){return l.isFunction(a)?I.parseCallback(a,b):a},mapPrepare:function(a,b){return I.parseCallback(a,b)},filterPrepare:function(a,b){return l.isFunction(a)||l.isString(a)?I.parseCallback(a,b):I.createFilterCallback(a)},reducePrepare:function(a,b,c){return l.isFunction(a)||l.isString(a)?I.parseCallback(a,c):I.parseCallback(a,c)},createFilterCallback:function(a){return function(b){return I.resolveFilterExpressionValue(!1,b,a)}},resolveFilterExpressionValue:function(a,b,c){if(c.field&&c.operator){var d=c.value;switch(b=b[c.field],c.operator.toLowerCase()){case"eq":a=b===d;break;case"neq":a=b!==d;break;case"lt":a=d>b;break;case"lte":a=d>=b;break;case"gt":a=b>d;break;case"gte":a=b>=d;break;case"startswith":a=l(b).startsWith(d);break;case"endswith":a=l(b).endsWith(d);break;case"contains":a=-1!==b.indexOf(d)}return a}if(c.logic&&c.filters){if(a&&"or"==c.logic)return!0;for(var e=!1,f=c.filters.length,g=0;f>g&&(e=I.resolveFilterExpressionValue(!1,b,c.filters[g]),!e||"or"!=c.logic);g++);return e}for(var h in c)if(b[h]!==c[h])return!1;return!0},flatten:function(a,b,c){if(l.isArray(b)||l.isArguments(b))if(a)c.push.apply(c,b);else for(var d=0;d<b.length;d++)I.flatten(a,b[d],c);else c.push(b)}};I.reduceRightPrepare=I.reducePrepare;for(var G in I)H[G]=I[G];var J={contains:function(a){return{boolResult:!1,args:["searchValue"],beforeLoop:"result"+a+"=false;",inLoop:"if (value===searchValue"+a+"){result"+a+"=true;break ;};"}},each:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:""===a?""+b:"",inLoop:"callback"+a+"(value,indexOrKey,collection);",prepareValues:b}},equals:function(a,b){var c="deepEqual"+a+"=deepEqual"+a+"===false?false:true;";return{boolResult:!0,args:["compareValue","deepEqual"],beforeLoop:(""===a?""+c:"")+"var index"+a+"=0;var resultResolved"+a+"=false;var size"+a+"=0;var key"+a+";result"+a+"=true;if (Object.prototype.toString.call(collection)!==Object.prototype.toString.call(compareValue"+a+")){result"+a+"=false;resultResolved"+a+"=true;};if (!resultResolved"+a+"){var aCtor=collection.constructor;var bCtor=compareValue"+a+'.constructor;if (aCtor!==bCtor&&!(blocks.isFunction(aCtor)&&aCtor instanceof aCtor&&blocks.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor" in collection&&"constructor" in compareValue'+a+")){result"+a+"=false;resultResolved"+a+"=true;}};",inLoop:("array"==b?"if (!resultResolved"+a+"){if (deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[size"+a+"],true):value!==compareValue"+a+"[size"+a+"]){result"+a+"=false;break;}size"+a+"+=1;};":"")+("object"==b?"if (!resultResolved"+a+"){if (blocks.has(collection,indexOrKey)){if (!blocks.has(compareValue"+a+",indexOrKey)||(deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[indexOrKey],true):value!==compareValue"+a+"[indexOrKey])){result"+a+"=false;break;}size"+a+"+=1;}};":""),afterLoop:("array"==b?"if (!compareValue"+a+"||size"+a+"!==compareValue"+a+".length){result"+a+"=false;resultResolved"+a+"=true;};":"")+("object"==b?"if (!resultResolved"+a+"&&result"+a+"){for (key"+a+" in compareValue"+a+"){if (blocks.has(compareValue"+a+",key"+a+")&&!size"+a+"--){break ;}}result"+a+"=!size"+a+";};":""),prepareValues:c}},every:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!0,args:["callback","thisArg"],beforeLoop:"result"+a+"=true;"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (!callback"+a+"(value,indexOrKey,collection)){result"+a+"=false;break ;}}else if (!value){result"+a+"=false;break ;};",prepareValues:b}},filter:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.filterPrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+f:"")+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):""),inLoop:"if (!callback"+a+"(value,indexOrKey,collection)){continue ;};"+e+";"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):""),prepareValues:f}},first:function(a){var b="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:b,everything:!0}},has:function(a){return{boolResult:!1,args:["key"],beforeLoop:"result"+a+"=false;",afterLoop:"result"+a+"=blocks.has(collection,key"+a+");"}},invoke:function(a,b,c,d){return{args:["method","args"],beforeLoop:"var isFunc"+a+"=blocks.isFunction(method"+a+");"+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):"")+(""===a?"args"+a+"=Array.prototype.slice.call(arguments,2);":""),inLoop:"value=(isFunc"+a+"?method"+a+":value[method"+a+"]).apply(value,args"+a+"||[]);"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):"")}},isEmpty:function(a){return{boolResult:!0,beforeLoop:"result"+a+"=true;",inLoop:"result"+a+"=false;"}},join:function(a){return{args:["separator"],beforeLoop:"separator"+a+"=typeof separator"+a+'=="undefined"?",":separator'+a+";result"+a+'="";',inLoop:"result"+a+"+=value+separator"+a+";",afterLoop:"result"+a+"=result"+a+".substring(0,result"+a+".length-separator"+a+".length);"}},map:function(a,b,c,d){var e="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+e:"")+(""===a?""+("array"==b?"result"+a+"=Array(collection.length);":"")+("object"==b?"result"+a+"=[];":""):"")+(""!==a&&0===d.length?"result"+a+"=[];":""),inLoop:"value=callback"+a+"(value,indexOrKey,collection);"+(""===a?""+("array"==b?"result"+a+"[indexOrKey]=value;":"")+("object"==b?"result"+a+".push(value);":""):"")+(""!==a&&0===d.length?"result"+a+".push(value);":""),prepareValues:e}},max:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var max"+a+"=-Infinity;result"+a+"=max"+a+";"+(""===a?""+b:""),inLoop:"max"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=max"+a+">result"+a+"?max"+a+":result"+a+";",prepareValues:b,type:"NumberExpression"}},min:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var min"+a+"=Infinity;result"+a+"=min"+a+";"+(""===a?""+b:""),inLoop:"min"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=min"+a+"<result"+a+"?min"+a+":result"+a+";",prepareValues:b,type:"NumberExpression"}},reduce:function(a){var b="callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");";return{args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?""+b:""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",prepareValues:b,everything:!0}},size:function(a,b){return{beforeLoop:(""===a?""+("array"==b?"return collection.length;":""):"")+"result"+a+"=0;",inLoop:"result"+a+"++;",type:"NumberExpression"}},some:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!1,args:["callback","thisArg"],beforeLoop:"result"+a+"=false;"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){result"+a+"=true;break ;}}else if (value){result"+a+"=true;break ;};",prepareValues:b}},type:"collection"};for(var G in J)J[G].identity=G,J[G].parent=J;var K={at:function(a){return{args:["position","count"],beforeLoop:"var isArray"+a+"=blocks.isNumber(count"+a+");var size"+a+"=0;indexOrKey=position"+a+"-1;if (isArray"+a+"){result"+a+"=[];};",inLoop:"if (isArray"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(value);}else {result=value;break ;};"}},flatten:function(a){return{args:["shallow"],beforeLoop:"var flatten"+a+"=blocks.core.flatten;result"+a+"=[];",inLoop:"flatten"+a+"(shallow"+a+",value,result"+a+");"}},indexOf:function(a){return{args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},last:function(a){var b="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{reverse:!0,args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".unshift(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:b,everything:!0}},lastIndexOf:function(a){return{reverse:!0,args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},range:function(a,b,c,d){return{args:["start","end","step"],beforeLoop:"length=Math.max(Math.ceil((end"+a+"-start"+a+")/step"+a+"),0);result"+a+"=Array(length);",inLoop:"value=start"+a+";start"+a+"+=step"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},reduceRight:function(a){return{reverse:!0,args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?"callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");":""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",everything:!0}},unique:function(a,b,c,d){var e="callback"+a+"=blocks.core.uniquePrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var seen"+a+"=[];var isFirst"+a+"=true;var isSorted"+a+"=blocks.isBoolean(callback"+a+")&&callback"+a+";var hasCallback"+a+"=blocks.isFunction(callback"+a+");var map"+a+";result"+a+"=[];"+(""===a?""+e:""),inLoop:"map"+a+"=hasCallback"+a+"?callback"+a+"(value,indexOrKey,collection):value;if (isSorted"+a+"?isFirst"+a+"||seen"+a+"[seen"+a+".length-1]!==map"+a+":!blocks.contains(seen"+a+",map"+a+")){isFirst"+a+"=false;seen"+a+".push(map"+a+");}else {continue ;};"+(""===a||0===d.length?"result"+a+".push(value);":""),prepareValues:e}},type:"array"};for(var G in K)K[G].identity=G,K[G].parent=K;var L={get:function(a){var b=(""===a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,1));":"")+(""!==a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,0));":"");return{args:["keys"],beforeLoop:(""===a?""+b:"")+"var singleKey"+a+"=keys"+a+".length<2;keys"+a+"=blocks.toObject(keys"+a+");result"+a+"={};",inLoop:"if (keys"+a+".hasOwnProperty(indexOrKey)){if (singleKey"+a+"){result"+a+"=value;}else {result"+a+"[indexOrKey]=value;}};",prepareValues:b}},invert:function(a,b,c,d){return{beforeLoop:"var temp"+a+";result"+a+"={};",inLoop:"temp"+a+"=value;value=indexOrKey;indexOrKey=temp"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},keys:function(a,b,c,d){return{beforeLoop:"result"+a+"=[];",inLoop:"value=indexOrKey;"+(""===a||0===d.length?"result"+a+".push(value);":"")}},pairs:function(a){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push({key:indexOrKey,value:value});"}},values:function(a){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push(value);"}},type:"object"};for(var G in L)L[G].identity=G,L[G].parent=L;var M,N,O={chainExpression:function(a){var b,c,d,e,f,g,h,i,j,k,m="";return m+="var "+a.indexOrKey+" = -1, "+a.collection+", "+a.length+", "+a.value+", "+(a.conditions?"":" "+a.result+a.resultIndex+",")+" "+a.result+(a.conditions?" = false":"")+"; "+a.conditionsDeclarations+" ",k=-1,l.each(a.args,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.args.length-1,m+=" ",g=-1,l.each(c,function(h,i){b=h,g+=1,f=i,e=0==i,d=i==c.length-1,m+=" var "+b+k+" = "+a.expression+"._"+b+"; "}),m+=" "+a.expression+" = "+a.expression+"._parent; "}),m+=" ",l.eachRight(a.variables,function(n,o){c=n,k=a.variables.length,k+=-1,j=o,i=0==o,h=o==a.variables.length-1,m+=" ",g=-1,l.each(c,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.length-1,m+=" var "+f+g+" = "+b+"; "}),m+=" "}),m+=" "+a.collection+" = "+a.expression+"._value; "+a.indexOrKey+" += "+a.skip+"; "+(a.take?" "+a.length+" = Math.min("+a.collection+".length, "+a.skip+" + "+a.take+"); ":"")+" "+(a.take?"":" "+a.length+" = "+a.collection+".length; ")+" "+(a.reverse?" "+a.indexOrKey+" = "+a.collection+".length - "+a.skip+"; ":"")+" ",l.eachRight(a.arrayBeforeLoops,function(b,d){c=b,k=a.arrayBeforeLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayBeforeLoops.length-1,m+=" "+c+" "}),m+=" "+(a.isObject?" for ("+a.indexOrKey+" in "+a.collection+") { ":"")+" "+(a.isObject?"":" "+(a.reverse?" while (--"+a.indexOrKey+" >= "+(a.take?a.take:"")+(a.take?"":"0")+") { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",l.eachRight(a.arrayInLoops,function(b,d){c=b,k=a.arrayInLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayInLoops.length-1,m+=" "+c+" "}),m+=" "+(a.inLoopConditions?" "+a.inLoopConditions+" ":"")+" } ",l.eachRight(a.arrayAfterLoops,function(b,d){c=b,k=a.arrayAfterLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayAfterLoops.length-1,m+=" "+c+" "}),m+=" "+(a.afterLoopConditions?" "+a.afterLoopConditions+" ":"")+" "+(a.conditions?"":" "+a.result+" = "+a.result+a.resultIndex+"; ")+" return "+a.result+"; "},conditions:function(a){var b,c,d,e,f,g="";return g+="if (",f=-1,l.each(a.items,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.items.length-1,g+=b}),g+=") { "+a.result+" = true; "+(a.inLoop?" break; ":"")+" } "},expressions:function(a){var b,c,d,e,f,g,h,i,j,k,m="";return m+="function "+a.name+"Expression( ",k=-1,l.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,m+=" "+c+", "}),m+=" parent ) { this._parent = parent; this._descriptor = descriptors."+a.descriptorName+"; ",k=-1,l.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,m+=" this._"+c+" = "+c+"; "}),m+=" } "+(a.isRoot?" function "+a.name+"Expression(value) { this._value = value; this._loopDescriptor = LoopDescriptors.chainExpression; } ":"")+" blocks.inherit(BaseExpression, "+a.name+"Expression, { _type: "+a.type+', _name: "'+a.name+'", ',k=-1,l.each(a.methods,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.methods.length-1,m+=" "+c.name+": function ( ",g=-1,l.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,m+=" "+b+", "}),m+=" a ) { var type = expressions."+a.path+c.name+"; if (!type) { type = (expressions."+a.path+c.name+' = generateExpression("'+a.name+c.name+'", "'+a.path+c.name+'", "'+c.name+'", '+a.type+")); } "+c.prepareValues+" expression = new type(",g=-1,l.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,m+=" "+b+", "}),m+=" this); "+(c.type?" if (this._hasConditions()) { this.result(); this._setLastCondition(); return new "+c.type+"(expression.value(), this); } return new "+c.type+"(expression.value()); ":"")+" "+(c.everything?" if (this._hasConditions()) { this.result(); this._setLastCondition(); } return blocks(expression.value(), this); ":"")+" return expression; }, "}),m+=" ",k=-1,l.each(a.staticMethods,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.staticMethods.length-1,m+=" "+j+" : "+c+", "}),m+=" reverse: function () { var type = expressions."+a.path+"reverse; if (!type) { type = (expressions."+a.path+'reverse = generateExpression("'+a.path+'reverse", "'+a.path+'reverse", "reverse", '+a.type+")); } var expression = new type(this); return expression; }, each: function (callback, thisArg) { var type = expressions."+a.path+"each; if (!type) { type = (expressions."+a.path+'each = generateExpression("'+a.path+'each", "'+a.path+'each", "each", '+a.type+")); } callback = PrepareValues.parseCallback(callback, thisArg); var expression = new type(callback, thisArg, this); expression._loop(); return expression; }, value: function () { if (this._parent && this._computedValue === undefined) { this._execute(true); this._computedValue = blocks.isBoolean(this._result) ? this._parent._value : this._result; } return this._computedValue === undefined ? this._value : this._computedValue; }, result: function () { if (this._result === true || this._result === false) { return this._result; } if (this._parent) { this._execute(); } return this._result; }, _loop: function () { var func = cache."+a.path+" || (cache."+a.path+" = createExpression(this)); func(this); }, _execute: function (skipConditions) { var func = cache."+a.path+" || (cache."+a.path+' = createExpression(this, skipConditions)); if (func) { this._setResult(func(this)); } else { this._result = this._findValue(); } }, _hasConditions: function () { var name = this._name; return name.indexOf("and") != -1 || name.indexOf("or") != -1; }, _setLastCondition: function () { var name = this._name; var andIndex = name.lastIndexOf("and"); var orIndex = name.lastIndexOf("or"); this._lastCondition = andIndex > orIndex ? "and" : "or"; }, _findValue: function () { var parent = this._parent; while (parent) { if (parent._value) { return parent._value; } parent = parent._parent; } } }); return '+a.name+"Expression; ";

},singleExpression:function(a){var b,c,d,e,f,g="";return g+="var "+a.length+" = "+a.collection+".length, "+a.indexOrKey+" = "+(a.reverse?"":"-1")+(a.reverse?a.length:"")+", "+a.isCollectionAnArray+" = "+a.isArrayCheck+", "+a.result+", "+a.value+"; ",f=-1,l.each(a.variables,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.variables.length-1,g+=" "}),g+=" if ("+a.isCollectionAnArray+") { ",f=-1,l.each(a.arrayBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayBeforeLoops.length-1,g+=" "+b+" "}),g+=" "+(a.reverse?" while (--"+a.indexOrKey+" >= 0) { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,l.each(a.arrayInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,l.each(a.arrayAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayAfterLoops.length-1,g+=" "+b+" "}),g+=" } else { ",f=-1,l.each(a.objectBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectBeforeLoops.length-1,g+=" "+b+" "}),g+=" for ("+a.indexOrKey+" in collection) { "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,l.each(a.objectInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,l.each(a.objectAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectAfterLoops.length-1,g+=" "+b+" "}),g+=" } return "+a.result+"; "},skip:function(a){var b="";return b+="if (skip"+a.index+"-- > 0) { continue; }"},take:function(a){var b="";return b+="if (take"+a.index+"-- <= 0) { break; }"},type:"loop"},P={},Q={},R=l.extend({},J,K,L,F);for(var G in R)M=R[G],l.isFunction(M)&&(N=M(" ","","",[]),y[G]={name:G,args:N.args,prepareValues:N.prepareValues||"",type:N.type,everything:N.everything});l.extend(D,{toObject:function(a){return new expressions.RootObjectExpression(blox.toObject(this.value(),a))},sortBy:function(a,b){return new expressions.RootArrayExpression(blox.sortBy(this.value(),a,b))},groupBy:function(a,b){return new expressions.RootObjectExpression(blox.groupBy(this.value(),a,b))},countBy:function(a,b){return new expressions.RootObjectExpression(blox.countBy(this.value(),a,b))},shuffle:function(){return new expressions.RootArrayExpression(blox.shuffle(this.value()))},set:function(a,b){return new expressions.RootObjectExpression(blox.set.call(void 0,this.value,a,b))},at:function(a,b){return new expressions.RootArrayExpression(blox.at(this._value,a,b))},concat:function(){var a=this.value();return new expressions.RootArrayExpression(a.concat.apply(a,arguments))},push:function(){var a=this.value();return a.push.apply(a,arguments),new expressions.RootArrayExpression(a)},pop:function(){var a=this.value();return a.pop(),new expressions.RootArrayExpression(a)},shift:function(){var a=this.value();return a.shift(),new expressions.RootArrayExpression(a)},slice:function(a,b){return new expressions.RootArrayExpression(this.value().slice(a,b))},sort:function(a){return new expressions.RootArrayExpression(this.value().sort(a))},splice:function(a,b){var c=this.value();return arguments.length>2?c.splice.apply(c,[a,b].concat(E.call(arguments,2))):c.splice(a,b),new expressions.RootArrayExpression(c)},unshift:function(){var a=this.value();return a.unshift.apply(a,arguments),new expressions.RootArrayExpression(a)}}),l.extend(D,{add:function(){return d(this.value(),arguments),this},remove:function(a,b){return l.remove(this.value(),a,b),this},removeAt:function(a,b){return l.removeAt(this.value(),a,b),this},removeAll:function(a,b){return 0===arguments.length?l.removeAll(this.value()):l.removeAll(this.value(),a,b),this},addMany:function(){return e(this.value(),arguments),this},swap:function(a,b){return l.swap(this.value(),a,b),this},move:function(a,b){return l.move(this.value(),a,b),this}});var S=c("RootArray","arr","",1,!0);l.extend(S.prototype,{reverse:function(){return new S(this._value.reverse())}}),l.extend(l,{add:function(a){return d(a,E.call(arguments,1))},addMany:function(a){return e(a,E.call(arguments,1))},remove:function(a,b,c){return x.isPosition(b)?l.removeAt(a,x.determineIndex(b,this._value.length),c):l.removeAll(a,b,c,!0)},removeAt:function(a,b,c){return l.isNumber(c)||(c=1),a.splice(b,c),a},removeAll:function(a,b,c,d){var e,f=0,g=l.isFunction(b);if(1==arguments.length)a.splice(0,a.length);else for(;f<a.length&&(e=a[f],!(e===b||g&&b.call(c,e,f,a))||(a.splice(f--,1),!d));f++);return a},toObject:function(a,b){for(var c,d={},e=arguments.length>1&&b,f=0,g=a.length;g>f;f++)c=a[f],l.isArray(c)?d[c[0]]=c[1]:l.isObject(c)?d[c.key]=c.value:d[c]=e?b[f]:!0;return d},shuffle:function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b=l.random(d),c[d]=c[b],c[b]=a[d];return c}});var T=c("RootObject","obj","",2,!0);l.set=function(a,b,c){var d;if(l.isString(b))a[b]=c;else for(d in b)a[d]=b;return a};var U=/^\s+|\s+$/gm,V=/^(\s|\u00A0)+/,W=/(\s|\u00A0)+$/;g.prototype.constructor=a,l.inherit(a,g,{_expression:g,type:function(){return"string"},substring:function(a,b){return new g(this._value.substring(a,b))},isEmpty:function(){return this._resultExpression(0==this._value.length)},size:function(){return new n(l.size(this._value))},contains:function(a){return this._resultExpression(-1!=this._value.indexOf(a))},startsWith:function(a){return this._resultExpression(l.startsWith(this._value,a))},endsWith:function(a){return this._resultExpression(l.endsWith(this._value,a))},trim:function(a){return new g(l.trim(this._value,a))},trimStart:function(a){return new g(l.trimStart(this._value,a))},trimEnd:function(a){return new g(l.trimEnd(this._value,a))},repeat:function(a){return new g(l.repeat(this._value,a))},reverse:function(){return new g(l.reverse(this._value))},wrap:function(a){return new g(l.wrap(this._value,a))},format:function(){return new g(h(this._value,E.call(arguments,0)))},matches:function(a,b){return new g(l.matches(this._value,a,b))},toUnit:function(a){return new g(l.toUnit(this._value,a))},clone:function(){return new g(this._value.toString())}}),l.extend(l,{startsWith:function(a,b){return l.isString(a)||(a=a.toString()),b=b.toString(),0==a.indexOf(b)},endsWith:function(a,b){return l.isString(a)||(a=a.toString()),b=b.toString(),a.lastIndexOf(b)==a.length-b.length},trim:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+|("+b+")+$","g"):U,"")},trimStart:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+"):V,"")},trimEnd:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("("+b+")+$"):W,"")},repeat:function(a,b){var c="",d=0;if(0>b||"number"!=typeof b)return a;for(b=Math.floor(b);b>d;d++)c+=a;return c},reverse:function(a){return l.isArray(a)?a.reverse():("string"!=typeof a&&(a=a.toString()),a.split("").reverse().join(""))},wrap:function(a,b){return l.isFunction(a)?function(){var c=[a];return push.apply(c,arguments),b.apply(this,c)}:b+a+l.reverse(b)},format:function(a){return h(a,E.call(arguments,1))},matches:function(a,b,c){c=l.isNumber(c)?c:Number.MAX_VALUE,l.isRegExp(b)||(b=new RegExp(b.toString(),"g"));var d,e,f=[];for(b.lastIndex=0,d=b.exec(a);c>0&&d&&(e=l.isArray(d)?d[0].length:d.length,f.push({result:d,input:d.input,startIndex:d.index,endIndex:d.index+e,length:e}),b.global);)d=b.exec(a),c--;return f}}),l.inherit(a,j,{bind:function(){return new j(l.bind.apply(this,[this._value].concat(E.call(arguments))))},partial:function(){return new j(k(this._value,E.call(arguments,0)))},memoize:function(a){return new j(l.memoize(this._value,a))},delay:function(a){return new j(m(this._value,a,E.call(arguments,1)))},throttle:function(a,b){return new j(l.throttle(this._value,a,b))},debounce:function(a,b){return new j(l.debound(this._value,a,b))},once:function(){return new j(l.once(this._value))},wrap:function(a){return new j(l.wrap(this._value,a))}}),l.extend(l,{partial:function(a){var b=E.call(arguments,1);return k(a,b)},memoize:function(a,b){var c={};return b||(b=z),function(){var d=b.apply(this,arguments);return c.hasOwnProperty(d)?c[d]:c[d]=a.apply(this,arguments)}},delay:function(a,b){return m(a,b,E.call(arguments,2))},throttle:function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=b.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=a-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=b.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},debounce:function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}}),l.random=function(a,b){return 0==arguments.length?Math.random():(null==b&&(b=a,a=0),a+Math.floor(0|Math.random()*(b-a+1)))},l.inherit(a,n,{_expression:n,type:function(){return"number"},toUnit:function(a){return a=a||"px",new g(this._value+a,this)},random:function(a,b){return new n(l.random(a,b),this)},biggerThan:function(a){var b=new n(this._value,this);return b._setResult(this._value>a),b},lessThan:function(){var a=new n(this._value,this);return a._setResult(this._value<value),a}}),l.inherit(a,o,{_expression:o,type:function(){return"date"},addWeeks:function(a){return l.addWeeks(this._value,a),this},compare:function(a){return new o(l.compare(this._value,a))},equalsDate:function(a){return this._setResult(l.equalsDate(this._value,a)),this},equalsTime:function(a){return this._setResult(l.equalsTime(this._value,a)),this},clearTime:function(){return new o(l.clearTime(this._value))}}),l.extend(l,{addWeeks:function(a,b){return a.setDate(a.getDate()+7*b),a},compare:function(a,b){var c=a-b;return c=0===c?c:0>c?-1:1},equalsDate:function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},equalsTime:function(a,b){return a.getHours()===b.getHours()&&a.getMinutes()===b.getMinutes()&&a.getSeconds()===b.getSeconds()&&a.getMilliseconds()===b.getMilliseconds()},clearTime:function(a){return a.setHours(0,0,0,0),a}}),l.each([["Years","FullYear"],["Months","Month"],["Days","Date"],"Hours","Minutes","Seconds","Milliseconds"],function(a){var b=a,c=a;l.isArray(a)&&(b=a[0],c=a[1]),b="add"+b,l[b]=function(a,b){return a["set"+c](a["get"+c]()+b),a},o.prototype[b]=function(a){return new o(l[b](this._value,a))}}),l.inherit(a,p,{equals:function(){},matches:function(a,b){return new p(l.matches(this._value,a,b))},reset:function(){},clone:function(){return new p(l.clone(this._value))}});var H=l.core;H.expressionsCreated=!0,H.trigger&&H.trigger("expressionsCreated"),H.createExpression=function(b){var c;return b instanceof Array||b&&b.jquery?new S(b):"string"==typeof b||b instanceof String?new g(b):"number"==typeof b||b instanceof Number?new n(b):b instanceof Date?new o(b):"[object RegExp]"===(c=f.call(b))?new p(b):null==b?new a(b):"__blocks.expression__"==b._prototypeIndentification?b:"[object Function]"==c?new j(b):new T(b)},H.isExpression=function(a){return a&&"__blocks.expression__"==a._prototypeIndentification},H.staticExpression={range:function(a,b,c){c=c||1,1==arguments.length&&(b=a,a=0);var d=new S([]);return d.range(a,b,c)},repeat:function(){}},H.isArrayExpression=function(a){return ChildArrayExpression.prototype.isPrototypeOf(a)},H.isObjectExpression=function(a){return ChildObjectExpression.prototype.isPrototypeOf(a)};var X={array:S,object:T},Y=l.toObject(["value","not","and","or","type","is","result"]);l.core.applyExpressions=function(a,b,c){if(X[a]){var d,e=X[a].prototype;for(d in e)b[d]||Y[d]||!l.isFunction(e[d])||c&&!c[d]||(b[d]=q(d))}};var Z=l.extend({},J,K,L);for(var G in Z)v(G);l.forEach=l.each;var $=l.at,w=v("at");l.at=function(a,b,c){return l.isNumber(a)?$(a):w(a,b,c)};var _=l.first,aa=v("first");l.first=function(a,b,c){return 0==arguments.length?_:aa(a,b,c)};var ba=l.last,ca=v("last");l.last=function(a,b,c){return 0==arguments.length?ba:ca(a,b,c)};var da=l.contains;l.contains=function(a,b){return l.isString(a)?-1!=a.indexOf(b):da(a,b)}}(),function(){function a(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}function b(a){var b={};return l.each(a,function(a){b[a]=!0}),b}function c(){return!1}function d(){return!0}function e(a){this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?d:c,this.timeStamp=a.timeStamp||+new Date}function f(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,e.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,e.fix(a))})}function g(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}function h(a){return String(a).replace(M,"&amp;").replace(N,"&lt;")}function i(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),-1!=a.indexOf("<option")&&-1==a.indexOf("<select")?(a="<select>"+a+"</select>",d=2):-1==a.indexOf("<table")&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):-1!=a.indexOf("<tr")?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}function j(a){return a?parseFloat(a[1]):void 0}function k(a,b,c){U[b]?U[b](a,c,function(b,c){f(a,b,c)}):f(a,b,c)}function m(a){return m.prototype.isPrototypeOf(this)?(this.__identity__=P,this._tagName=a?a.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=m.RenderMode.All,this._haveStyle=!1,this._style={},this._states=null,this._state=null,void(l.isElement(a)&&(this._el=a))):new m(a)}function n(a,b){var c,d,e=' style="',f=!1;for(c in a)d=a[c],b&&O.call(b.style,c)||(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");if(b)for(c in b.style)d=b.style[c],(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");return e+='"',f?e:""}function o(a){return"-"+a.toLowerCase()}function p(a,b,c){if(null!=c){c=l.isArray(c)?c:c.toString().split(" ");var d,e,f,h=0;if(m.Is(b))d=b._getAttr(I);else{if(b.classList)return void($?b.classList[a].apply(b.classList,c):l.each(c,function(c){b.classList[a](c)}));d=b.className}for(d=d||"";h<c.length;h++)e=c[h],f=g(d,e),"add"==a?0>f&&(""!==d&&(e=" "+e),d+=e):-1!=f&&(d=(d.substring(0,f)+" "+d.substring(f+e.length+1,d.length)).replace(H,""));m.Is(b)?b._state?b._state.attributes[I]=d:b._attributes[I]=d:b.className=d}}function q(a,b){var c=T.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,h=0;b!=h;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,-1==g(d,"b-hide")&&h++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;-1!=g(d,"b-hide");){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function r(a,b){var c=!1,d=T.createIfNotExists(b),e=T.createIfNotExists(b.parentNode),f=d.animateCallback,g="remove"==a?"hide":"add"==a?"show":a,h="remove"==a?function(){T.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:l.noop,i=function(){d.animating-=1,e.animating-=1,d.animating||h()};if(1!=b.nodeType)return void h();if("show"==a&&(b.style.display=""),d.preprocess)return void h();if(f){c=!0,d.animating+=1,e.animating+=1;var j=l.context(b),k=j.$view||j.$root;f.call(k,b,i,g)}return c||s(g,b,h,i)}function s(a,b,c,d){function e(){p("remove",b,"b-"+a),p("remove",b,"b-"+a+"-end"),d(),b.removeEventListener("transitionend",e,!1),b.removeEventListener(f,e,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();p("add",b,"b-"+a);var f,g=window.getComputedStyle(b),h="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(h="-webkit-",f="webkitAnimationEnd"):f="animationend";var i=parseFloat(g["transition-duration"])||0,j=parseFloat(g["transition-delay"])||0,k=parseFloat(g[h+"animation-duration"])||0,l=parseFloat(g[h+"animation-delay"])||0;return 0>=i&&0>=j&&0>=k&&0>=l||!t(b,a)?(p("remove",b,"b-"+a),void c()):(T.createIfNotExists(b).animating+=1,T.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){p("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",e,!1),b.addEventListener(f,e,!1)},1),!0)}function t(a,b){var c,d,e,f=ba[a.className+a.getAttribute("style")+a.tagName],g=!1;return f||f===!1?f:(p("remove",a,"b-"+b),d=l.extend({},window.getComputedStyle(a)),p("add",a,"b-"+b),p("add",a,"b-"+b+"-end"),e=window.getComputedStyle(a),c=e.transitionProperty.split(","),l.each(c,function(a){if(a=a.trim().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),"all"==a){for(var b in e)e[b]!=d[b]&&(g=!0);return!1}return e[a]!=d[a]?(g=!0,!1):void 0}),p("remove",a,"b-"+b+"-end"),ba[a.className+a.getAttribute("style")+a.tagName]=g,g)}function u(a){return u.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==a.nodeType?(this._commentText=a.nodeValue,this._el=a):this._commentText=a)):new u(a)}function v(a,b){for(var c,d,e,f,g,i,j,k,n,o=window.__blocksServerData__,p=[];a;){if(i=a.nodeType,1==i){d=a.tagName.toLowerCase(),c=new m(a),c._tagName=d,c._parent=b,b&&(c._each=b._each||b._childrenEach),c._haveAttributes=!1,f=a.attributes,e={};for(var q=0;q<f.length;q++)g=f[q],"style"!==g.nodeName&&(g.specified||S.IE<8&&"value"==g.nodeName&&g.nodeValue)&&(e[g.nodeName.toLowerCase()]=S.IE<11?g.nodeValue:g.value,c._haveAttributes=!0);c._attributes=e,c._createAttributeExpressions(o),a.style.cssText&&(c._haveStyle=!0,c._style=w(a.style.cssText)),x(c),"script"==d||"style"==d||"code"==d||c.hasClass("bl-skip")?c._innerHTML=a.innerHTML:c._children=v(a.childNodes[0],c),p.push(c)}else if(3==i)n=h(a.data),p.push(Z.Create(n,null,a)||n);else if(8==i)if(j=a.nodeValue,k=j.replace(H,""),0===k.indexOf("blocks"))c=new u(a),c._parent=b,c._attributes[R]=k.substring(6),n=v(a.nextSibling,c),c._children=n.elements,c._el._endElement=n.htmlElement,a=n.htmlElement||a,p.push(c);else{if(u.Is(b)&&0===k.indexOf("/blocks"))return{elements:p,htmlElement:a};if(u.Is(b))p.push("<!--"+j+"-->");else if(o){var r=parseInt(/[0-9]+/.exec(k),10);!l.isNaN(r)&&o[r]&&p.push(Z.Create(o[r]))}else 0!==k.indexOf("/blocks")&&p.push("<!--"+j+"-->")}a=a.nextSibling}return p}function w(a){for(var b,c,d,e=a.split(";"),f={},g=0;g<e.length;g++)c=e[g],c&&(b=c.indexOf(":"),-1!=b&&(d=[c.substring(0,b),c.substring(b+1)],f[d[0].toLowerCase().replace(H,"")]=d[1].replace(H,"")));return f}function x(a){var b,c=a._tagName;return void 0!==ca[c]?void(a._isSelfClosing=ca[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(ca[c]=a._isSelfClosing=-1===b.innerHTML.indexOf("</")))}function y(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}function z(a,b){var c,d,e=0,f=0,g=0,h=0,i=!1,j=!1,k=0,l=[];a=a||"";for(var m=0;m<a.length;m++)e=a.charAt(m),i||j||("["==e?h++:"]"==e?h--:"{"==e?g++:"}"==e&&g--),0===g&&0===h&&("'"==e?i=!i:'"'==e&&(j=!j),i||j||("("==e?(0===f&&(d=a.substring(k,m).replace(H,""),k=m+1),f++):")"==e?(f--,0===f&&(c=a.substring(k,m).replace(H,""),c.length&&l.push(c),d&&(d=d.replace(/^("|')+|("|')+$/g,""),b(d,l)),l=[],d=void 0)):","==e&&1==f?(c=a.substring(k,m).replace(H,""),c.length&&l.push(c),k=m+1):"."==e&&0===f&&(k=m+1)))}function A(a){this._options=a||{}}function B(a,b){var c=A.QueryCache[a]=[];return z(a,function(a,d){var e=l.queries[a],f={name:a,params:d,query:a+"("+d.join(",")+")"};e?"attr"==a||"val"==a?c.unshift(f):c.push(f):l.debug.queryNotExists(f,b)}),c}function C(a){this.observable=a,this.chunkLengths={},this.dispose()}function D(a){a._dependencyType&&(a._getDependency=l.bind(E,a),a.on("get",a._getDependency))}function E(){var a=this,b=a.__value__,c=1==a._dependencyType?b:b.get;G.off(a,"get",a._getDependency),a._getDependency=void 0,Y.startObserving(),c.call(a.__context__),l.each(Y.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;l.each(c,function(b){return a===b?(d=!0,!1):void 0}),d||c.push(a)})}function F(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}var G=function(){function a(a){return function(b,c){return arguments.length>1?G.on(this,a,b,c):G.on(this,a,b),this}}var b={on:function(a,b,c){return arguments.length>2?G.on(this,a,b,c):G.on(this,a,b),this},once:function(a,b,c){G.once(this,a,b,c)},off:function(a,b){G.off(this,a,b)},trigger:function(a){G.trigger(this,a,l.toArray(arguments).slice(1,100))}};return b._trigger=b.trigger,{register:function(c,d){d=l.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]=b[f]?b[f]:a(f)}},on:function(a,b,c,d){b=l.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});g>f;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,thisArg:d})},once:function(a,b,c,d){G.on(a,b,c,d),G.on(a,b,function(){G.off(a,b,c)})},off:function(a,b,c){l.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?l.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:l.each(d,function(b,d){return b.callback==c?(a._events[e].splice(d,1),!1):void 0})}):a._events=void 0},trigger:function(a,b){var c,d,e,f=!0;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(e=Array.prototype.slice.call(arguments,2),l.each(c,function(b){b&&(d=a,void 0!==b.thisArg&&(d=b.thisArg),b.callback.apply(d,e)===!1&&(f=!1))}))),f},has:function(a,b){return!!l.access(a,"_events."+b+".length")}}}();!function(){function b(){if("complete"===document.readyState)setTimeout(d);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1);else{document.attachEvent("onreadystatechange",c),window.attachEvent("onload",c);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(b){}a&&a.doScroll&&!function e(){if(!l.isDomReady){try{a.doScroll("left")}catch(b){return setTimeout(e,50)}d()}}()}}function c(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&d()}function d(){l.isDomReady||(l.isDomReady=!0,G.trigger(l.core,"domReady"),G.off(l.core,"domReady"))}l.isDomReady=!1,l.domReady=function(c,d){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(c=a(c,d),l.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(l.isDomReady=!0,c()):(G.on(l.core,"domReady",c),b()))}}();var H=(Array.prototype.slice,/^\s+|\s+$/gm),I="class",J=l.queries={},K=/^(?:mouse|pointer|contextmenu)|click/,L=/^key/;e.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},e.CopyProperties=function(a,b,c){l.each(e.PropertiesToCopy[c],function(c){b[c]=a[c]})},e.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=d,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=d,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=d,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},e.fix=function(a){var b=a.type,c=new e(a);return e.CopyProperties(a,c,"all"),c.target||(c.target=a.srcElement||document),3===c.target.nodeType&&(c.target=c.target.parentNode),c.metaKey=!!c.metaKey,K.test(b)?e.fixMouse(a,c):L.test(b)&&null==c.which&&(e.CopyProperties(a,c,"keyboard"),c.which=null!=a.charCode?a.charCode:a.keyCode),c},e.fixMouse=function(a,b){var c,d,f,g=a.button,h=a.fromElement;e.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(d=b.target.ownerDocument||document,f=d.documentElement,c=d.body,b.pageX=a.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),b.pageY=a.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!b.relatedTarget&&h&&(b.relatedTarget=h===b.target?a.toElement:h),b.which||void 0===g||(b.which=1&g?1:2&g?3:4&g?2:0)};var M=/&/g,N=/</g,O=Object.prototype.hasOwnProperty,P="__blocks.VirtualElement__",Q="data-id",R="data-query",S={};"undefined"!=typeof document&&l.extend(S,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&j(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&j(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))});var T=function(){function a(a){var b=a?m.Is(a)?a._state?a._state.attributes[Q]:a._attributes[Q]:1==a.nodeType?a.getAttribute(Q):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return l.isArray(b)?b[1]:b}function b(a,b){m.Is(a)?a.attr(Q,b):1==a.nodeType&&a.setAttribute(Q,b)}var c={},d=1;return{id:function(b){return a(b)},reset:function(){c={},d=1},collectGarbage:function(){l.each(c,function(a){a&&a.dom&&!document.body.contains(a.dom)&&T.clear(a.id,!0)})},createIfNotExists:function(e){var f,g,h=e&&e.__identity__==P;return f=h?c[e._getAttr(Q)]:c[e&&a(e)],f||(g=d++,e&&(h&&e._each?(e._haveAttributes=!0,e._state?e._state.attributes[Q]=g:e._attributes[Q]=g):b(e,g)),f=c[g]=e?{id:g,virtual:h?e:null,animating:0,observables:{},preprocess:h}:{id:g}),f},byId:function(a){return c[a]},data:function(b,d,e){var f=c[a(b)||b];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[d]=e),f[d])},clear:function(b,d){var e=a(b)||b,f=c[e];!f||f.haveData&&!d||(l.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==c.id&&(a._elements.splice(b,1),b--)}),c[e]=void 0,m.Is(b)?b.attr(Q,null):1==b.nodeType&&b.removeAttribute(Q))}}}(),U={input:function(a,b,c){function d(a){clearTimeout(f),b(a)}function e(){f||(f=setTimeout(d,4))}var f;S.IE<10?(c("propertychange",function(a){"value"===a.originalEvent.propertyName&&d(a)}),8==S.IE&&(c("keyup",d),c("keydown",d)),S.IE>=8&&(V(a,d),c("dragend",e))):(c("input",d),S.Safari<7&&"textarea"==a.tagName.toLowerCase()?(c("keydown",e),c("paste",e),c("cut",e)):S.Opera<11?c("keydown",e):S.Firefox<4&&(c("DOMAutoComplete",d),c("dragdrop",d),c("drop",d)))}},V=function(){function a(a){var b=this.activeElement,c=b&&T.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(f(c.ownerDocument,"selectionchange",a),b=!0),T.createIfNotExists(c).selectionChange=d}}(),W=l.dom={valueTagNames:{input:!0,textarea:!0,select:!0},valueTypes:{file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},props:{"for":!0,"class":!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},propFix:{"for":"htmlFor","class":"className",tabindex:"tabIndex"},attrFix:{className:"class",htmlFor:"for"},addClass:function(a,b){a&&p("add",a,b)},removeClass:function(a,b){a&&p("remove",a,b)},html:function(a,b){if(a)if(b=b.toString(),8==a.nodeType)W.comment.html(a,b);else if(S.IE<10){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(i(b))}else a.innerHTML=b},css:function(a,b,c){a&&b&&("display"==b?aa.setVisibility(a,"none"==c?!1:!0):a.style[b]=c)},on:function(a,b,c){a&&k(a,b,c)},off:function(){},removeAttr:function(a,b){a&&b&&W.attr(a,b,null)},attr:function(a,c,d){var e=W.props[c];return c=W.propFix[c.toLowerCase()]||c,l.core.skipExecution&&l.core.skipExecution.element===a&&l.core.skipExecution.attributeName==c||!a?void 0:8==a.nodeType?void W.comment.attr(a,c,d):("checked"==c&&(d="checked"!=d&&"string"==typeof d&&"radio"==a.getAttribute("type")&&d!=a.value&&null!=a.defaultValue&&""!==a.defaultValue?!1:!!d),1===arguments.length?e?a[c]:a.getAttribute(c):void(null!=d?"value"==c&&"select"==a.tagName.toLowerCase()?(d=b(l.toArray(d)),l.each(a.children,function(a){a.selected=!!d[a.value]})):e?a[c]=d:a.setAttribute(c,d):e?"value"==c&&"select"==a.tagName.toLowerCase()?a.selectedIndex=-1:a[c]&&(a[c]=""):a.removeAttribute(c)))},comment:{html:function(a,b){for(var c,d=a,e=d.parentNode,f=d.nextSibling,g=0;f&&(8!=f.nodeType||-1==f.nodeValue.indexOf("/blocks"));)g++,c=f.nextSibling,e.removeChild(f),f=c;return e.insertBefore(i(b),d.nextSibling),g},attr:function(a,b,c){if(a&&b==Q&&c){var d=a,e=a._endElement;return d.nodeValue=" "+c+":"+d.nodeValue.replace(H,"")+" ",e.nodeValue=" "+c+":"+e.nodeValue.replace(H,"")+" ",this}return this}}},X={},Y=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(l.each(c,function(a){return a===b?(d=!0,!1):void 0}),d||c.push(b))}}}(),Z={Html:0,ValueOnly:2,Create:function(a,b,c){for(var d,e,f,g=-1,h=0,i=[];a.length>++g;)d=a.charAt(g),"{"==d&&"{"==a.charAt(g+1)?e=g+2:"}"==d&&"}"==a.charAt(g+1)&&(e&&(f=a.substring(e,g),b||(f=f.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),d=a.substring(h,e-2),d&&i.push(d),i.push({expression:f,attributeName:b}),h=g+2),e=0);return d=a.substring(h),d&&i.push(d),i.text=a,i.attributeName=b,i.element=c,i.isExpression=!0,f?i:null},GetValue:function(a,b,c,d){var e,f="",g=c.length,h=-1;if(!a)return c.text;if(1==g)f=Z.Execute(a,b,c[0],c,d);else for(;++h<g;)e=c[h],f+="string"==typeof e?e:Z.Execute(a,b,e,c,d);return c.lastResult=f,f},Execute:function(a,b,c,d,e){var f,g,i,j,k,m,n=c.expression,o=c.attributeName;m=X[n]=X[n]||new Function("c","with(c){with($this){ return "+n+"}}"),Y.startObserving();try{k=m(a)}catch(p){l.debug.expressionFail(n,d.element)}return k=m(a),f=l.isObservable(k),j=f?k():k,j=null==j?"":j.toString(),j=h(j),i=Y.stopObserving(),e!=Z.ValueOnly&&(f||i.length)&&(o||(b=T.createIfNotExists()),b&&(b.haveData=!0,g={length:j.length,attr:o,context:a,elementId:b.id,expression:n,entire:d},l.each(i,function(a){a._expressionKeys[b.id]||(a._expressionKeys[b.id]=!0,a._expressions.push(g))})),o||(j="<!-- "+b.id+":blocks -->"+j)),j}};l.VirtualElement=l.inherit(m,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._state?this._state.html!==a&&(this._state.html=a,W.html(this._el,a)):(this._innerHTML=a,W.html(this._el,a)),this._children=[],this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=h(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,c){var d,e=this;if("string"==typeof a){var f=this._tagName,g=this._attributes.type,h=c,i=T.data(this),j=this._getAttr("value");if(a=l.unwrapObservable(a),a=W.attrFix[a]||a,c=l.unwrapObservable(c),l.isObservable(h)&&"value"==a&&W.valueTagNames[f]&&(!g||W.valueTypes[g])?(i.subscribe="select"==f?"change":"input",i.valueObservable=h):!l.isObservable(h)||"checked"!=a||"checkbox"!=g&&"radio"!=g||(i.subscribe="click",i.valueObservable=h),1==arguments.length)return d=this._getAttr(a),void 0===d?null:d;"checked"!=a||null==c||this._fake?"disabled"==a&&(c=c?"disabled":null):c="radio"==this._attributes.type&&"string"==typeof c&&j!=c&&null!=j?null:c?"checked":null,"textarea"!=f||"value"!=a||this._el?"value"==a&&"select"==f?(this._values=b(l.toArray(c)),W.attr(this._el,a,c)):(this._haveAttributes=!0,this._state?this._state.attributes[a]!==c&&(this._state.attributes[a]=c,W.attr(this._el,a,c)):(this._attributes[a]=c,W.attr(this._el,a,c))):this.html(c)}else l.isPlainObject(a)&&l.each(a,function(a,b){e.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,
W.removeAttr(this._el,a),this},css:function(a,b){var c=this;if("string"==typeof a){if(a=l.unwrap(a),b=l.unwrap(b),!a)return;if(a=a.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return b=this._getCss(a),void 0===b?null:b;"display"==a&&(b="none"==b||!b&&""!==b?"none":""),this._haveStyle=!0,m.CssNumbers[a]||(b=l.toUnit(b)),this._state?this._state.style[a]!==b&&(this._state.style[a]=b,W.css(this._el,a,b)):(this._style[a]=b,W.css(this._el,a,b))}else l.isPlainObject(a)&&l.each(a,function(a,b){c.css(b,a)});return this},addChild:function(a,b){var c,d=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el&&(c=i(a.render(l.domQuery(this))),a._el=c.childNodes[0],"number"==typeof b?this._el.insertBefore(c,this._el.childNodes[b]):this._el.appendChild(c)),"number"==typeof b?d.splice(b,0,a):d.push(a)),this},addClass:function(a){return p("add",this,a),W.addClass(this._el,a),this},removeClass:function(a){return p("remove",this,a),W.removeClass(this._el,a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return-1!=g(this._attributes[I],a)},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=n(this._style,this._state)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(a,b){var c="",d="",e=this._el;return void 0!==b&&(this._state={attributes:{},style:{},html:null,expressions:{}},this._states||(this._states={}),this._states[b]=this._state),this._el=void 0,this._execute(a),this._el=e,this._renderMode!=m.RenderMode.None&&(this._renderMode!=m.RenderMode.ElementOnly&&(d=this._state&&null!==this._state.html?this._state.html:null!=this._innerHTML?this._innerHTML:this.renderChildren(a,b)),c+=this.renderBeginTag(),c+=d,c+=this.renderEndTag()),this._state=null,c},renderChildren:function(a,b){for(var c,d,e="",f=this._template||this._children,g=f.length,h=-1;++h<g;)c=f[h],"string"==typeof c?e+=c:m.Is(c)?(c._each=c._each||this._each,e+=c.render(a,b)):a?(d=Z.GetValue(a._context,null,c),this._state&&(this._state.expressions[h]=d),e+=d):e+=!this._each&&c.lastResult?c.lastResult:Z.GetValue(null,null,c);return e},sync:function(a,b,c){b&&(this._state=this._states[b],this._el=c,this._each=!1,this._sync=!0),this._execute(a),this.renderBeginTag(),this._innerHTML||this._childrenEach||this._renderMode==m.RenderMode.None||this.syncChildren(a,b),this.renderEndTag(),b&&(this._state=null,this._el=void 0,this._each=!0,this._sync=!1)},syncChildren:function(a,b,c){for(var d,e,f,g=this._template||this._children,h=g.length,j=this._state,k=8==this._el.nodeType?this._el.nextSibling:this._el.childNodes[c||0],l=-1;++l<h;)f=g[l],f.isExpression?a&&(e=Z.GetValue(a._context,null,f,j?Z.ValueOnly:Z.Html),(!j||j&&j.expressions[l]!==e)&&(j?(j.expressions[l]=e,k?(8==k.nodeType&&(k=k.nextSibling),k.nodeValue=e,k=k.nextSibling):this._el.textContent=e):(this._el.insertBefore(i(e),k),d=k,k=k.nextSibling,this._el.removeChild(d)))):"string"!=typeof f&&f._renderMode!=m.RenderMode.None?(f._each=f._each||this._each,f.sync(a,b,k),k=k.nextSibling):k=k.nextSibling},updateChildren:function(a,b,c,d){for(var e,f=this._template,g=f[0],h=1===f.length&&m.Is(g),i=d.childNodes,j=c.getSyncIndex(),k=c._context.childs,l=this._length(),n=this._headers?this._headers.length:0,o=-1;++o<b;)c._context=e=k[o],e.$this=a[o],e.$parent=e.$parentContext.$this,h?g.sync(c,j+o,i[o+n]):this.syncChildren(c,j+o,o*l+n);c.popContext()},_length:function(){for(var a=this._template,b=-1,c=0;++b<a.length;)a[b]._renderMode!==m.RenderMode.None&&(c+=1);return c},_getAttr:function(a){var b=this._state;return b&&void 0!==b.attributes[a]?b.attributes[a]:this._attributes[a]},_getCss:function(a){var b=this._state;return b&&void 0!==b.style[a]?b.style[a]:this._style[a]},_execute:function(a){if(a&&(this._each&&(this._el=void 0),this._renderMode!=m.RenderMode.None)){var b,c=this._attributes[Q];(!c||a._serverData)&&(T.createIfNotExists(this),a.applyContextToElement(this),c=this._attributes[Q],b=T.byId(c)),this._attributeExpressions.length&&this._executeAttributeExpressions(a._context),a.executeQuery(this,this._attributes[R]),b&&!b.haveData&&T.clear(this)}},_renderAttributes:function(){var a,b,c=this._attributes,d=this._state,e="";"option"==this._tagName&&this._parent._values&&(d?d.attributes.selected=this._parent._values[d.attributes.value]?"selected":null:c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],d&&O.call(d.attributes,a)||(""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"'));if(d)for(a in d.attributes)b=d.attributes[a],""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"');return e},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[Q],e=this._each;l.each(this._attributes,function(f,g){b=!e&&a&&a[d+g]?Z.Create(a[d+g],g):Z.Create(f,g),b&&c.push(b)})},_executeAttributeExpressions:function(a){for(var b,c,d,e=this._el?!1:!0,f=this._state&&this._state.attributes,g=T.byId(f?f[Q]:this._attributes[Q]),h=this._attributeExpressions,i=0;i<h.length;i++)c=h[i],d=Z.GetValue(a,g,c),b=c.attributeName,(f&&f[b]!==d||!f)&&(e?this._state?this._state.attributes[b]=d:this._attributes[b]=d:W.attr(this._el,b,d))}}),m.Is=function(a){return a&&a.__identity__==P},m.RenderMode={All:0,ElementOnly:2,None:4},m.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0};var $=!0;if("undefined"!=typeof document){var _=document.createElement("div");_.classList&&(_.classList.add("a","b"),$="a b"==_.className)}var aa={insert:function(a,b,c){b=q(a,b);var d,e,f=a.childNodes[b];l.each(c,function(b){if(d=11==b.nodeType?b.childNodes.length:0,e=b.childNodes?b.childNodes[0]:void 0,f?a.insertBefore(b,f):a.appendChild(b),d)for(;d;)r("add",e),e=e.nextSibling,d--;else r("add",b)})},remove:function(a,b,c){var d,e=0;for(b=q(a,b);c>e;e++)d=a.childNodes[b],d&&r("remove",d)&&b++},setVisibility:function(a,b){b?aa.show(a):aa.hide(a)},show:function(a){r("show",a)},hide:function(a){r("hide",a)}},ba={};l.VirtualComment=l.inherit(m,u,{renderBeginTag:function(){var a=this._getAttr(Q),b="<!-- ";return a&&(b+=a+":"),b+=this._commentText.replace(H,"")+" -->"},renderEndTag:function(){var a=this._getAttr(Q),b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:l.noop}),u.Is=function(a){return u.prototype.isPrototypeOf(a)};var ca={};A.QueryCache={},A.prototype={options:function(){return this._options},dataIndex:y("_dataIndex"),context:y("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=T.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=T.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null,__props__:c&&c.__props__},b.$context=b,this._context=b,this.applyProperties(),b},getSyncIndex:function(){for(var a=this._context,b="";a&&a.$index;)b=a.$index.__value__+"_"+b,a=a.$parentContext;return b},contextBubble:function(a,b){var c=this._context;this._context=a,b(),this._context=c},addProperty:function(a,b){var c=this._context;c.__props__=c.__props__||{},c.__props__[a]=b,this.applyProperties()},applyProperties:function(){var a,b=this._context.__props__;for(a in b)this._context[a]=b[a]},executeElementQuery:function(a){var b=m.Is(a)?a._attributes[R]:1==a.nodeType?a.getAttribute(R):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(H,"");b&&this.executeQuery(a,b)},executeQuery:function(a,b){var c=A.QueryCache[b]||B(b,a);this.executeMethods(a,c)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=T.data(a),k=0,n=0;n<b.length;n++)if(h=this._context,c=l.queries[b[n].name],f=b[n].params,d=c.passDomQuery?[this]:[],!m.Is(a)||c.call||c.preprocess||!c.update&&!c.ready){Y.startObserving();for(var o=0;o<f.length;o++){g=f[o],i=X[g]=X[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={};try{e.rawValue=i(h)}catch(p){l.debug.queryParameterFail(b[n],g,a)}if(e.rawValue=i(h),e.value=l.unwrapObservable(e.rawValue),c.passDetailValues?(e.isObservable=l.isObservable(e.rawValue),e.containsObservable=Y.currentObservables().length>k,k=Y.currentObservables().length,d.push(e)):d.push(c.passRawValues?e.rawValue:e.value),c===l.queries["if"]||c===l.queries.ifnot){if(!e.value&&c===l.queries["if"]||e.value&&c===l.queries.ifnot){if(!f[2])break;this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}}var q=d;if(c.passDomQuery&&(q=l.clone(d).slice(1)),l.debug.checkQuery(b[n].name,q,b[n],a),m.Is(a)){if(u.Is(a)&&!c.supportsComments)continue;if(c.call)c.call===!0?a[b[n].name].apply(a,d):(d.unshift(c.prefix||b[n].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[n],j,h);break}}else if(c.call){var r=T.data(a).virtual;r._each&&(r=m("div"),r._el=a,r._fake=!0),c.call===!0?r[b[n].name].apply(r,d):(d.unshift(c.prefix||b[n].name),r[c.call].apply(r,d))}else j&&j.preprocess&&c.ready?c.ready.apply(a,d):c.update&&c.update.apply(a,d);this.subscribeObservables(b[n],j,h)}else j.haveData=!0,j.execute||(j.execute=[],j.executeHash={}),j.executeHash[b[n].query]||(j.execute.push(b[n]),j.executeHash[b[n].query]=!0)},subscribeObservables:function(a,b,c){var d=Y.stopObserving();b&&(b.haveData=!0,l.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e],d=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(c=T.data(b)){if(this._context=c.context||this._context,c.dom=b,c.execute&&this.executeMethods(b,c.execute),c.subscribe){var f=c.updateOn||c.subscribe;k(b,f,da[f])}c.preprocess=!1,this._context=c.childrenContext||this._context}"script"!=d&&"code"!=d&&-1==(" "+b.className+" ").indexOf("bl-skip")&&this.createElementObservableDependencies(b.childNodes)}this._context=null},createFragment:function(a){var b=i(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=l.clone(a);return b.$context=b,b}};var da={change:function(a){var b=a.target||a.srcElement;da.getSetValue(b,T.data(b).valueObservable)},click:function(a){da.change(a)},input:function(a){var b=a.target||a.srcElement;da.getSetValue(b,T.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,c=b.value,d=T.data(b);d&&setTimeout(function(){c!=b.value&&da.getSetValue(b,T.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if("checkbox"==d)b(a.checked);else if("select"==c&&a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?l.each(f,function(a){e.push(a.getAttribute("value"))}):l.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else l.core.skipExecution={element:a,attributeName:"value"},b(a.value),l.core.skipExecution=void 0}};l.extend(J,{"if":{},ifnot:{},template:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){var d,e=a._serverData;if(b=l.$unwrap(b),l.isElement(b)?d=b.innerHTML:(d=document.getElementById(b),d=d?d.innerHTML:b),d&&(c&&l.queries["with"].preprocess.call(this,a,c,"$template"),!e||!e.templates||!e.templates[T.id(this)]))if(this._el)this.html(d),this._each||(this._children=v(this._el.childNodes[0],this),this._innerHTML=null);else{var f=document.createElement("div");f.innerHTML=d,this._children=v(f.childNodes[0],this),this._innerHTML=null}}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;T.data(this).context=e,a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.context(d),f.call(this)}}}},"with":{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=this.renderEndTag;c&&a.addProperty(c,b),a.pushContext(b),this.renderEndTag=function(){return a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,d,e,f=b._children,g=b._headers,h=b._footers,i=-1,j="",k="";if(g)for(c=Math.max(g.length,h.length);++i<c;)g[i]&&(j+=g[i].render(a)),h[i]&&(k+=h[i].render(a));else for(g=b._headers=[],h=b._footers=[];++i<f.length;)e=f[i],e.isExpression||("string"!=typeof e?(e._each=!0,d=e._attributes["data-role"],"header"==d?(j+=e.render(a),g.push(e),f.splice(i--,1)):"footer"==d&&(k+=e.render(a),h.push(e),f.splice(i--,1))):""===e.replace(H,"").replace(/(\r\n|\n|\r)/gm,"")&&f.splice(i--,1));return{header:j,headersCount:g.length,footer:k,footersCount:h.length}},preprocess:function(a,b){var c,d,e,f,g,h=a.getSyncIndex(),i=this,j=0;if(this._sync)return void i.updateChildren(b,b.length,a,this._el);if(this._template=this._template||this._children,this._childrenEach=!0,a._serverData&&(d=a._serverData[T.id(this)],a._serverData[T.id(this)]=void 0,d)){var k=document.createElement("div");k.innerHTML=d,i._template=i._children=v(k.childNodes[0],i)}if(e=J.each._getStaticHtml(a,i),g=e.header,l.isObservable(b)&&(d=T.data(i),d.eachData={id:b.__id__,element:i,startOffset:e.headersCount,endOffset:e.footersCount}),c=l.unwrapObservable(b),f=a._context.childs=[],l.isArray(c))for(j=0;j<c.length;j++)a.dataIndex(l.observable.getIndex(b,j)),f.push(a.pushContext(c[j])),g+=this.renderChildren(a,h+j),a.popContext(),a.dataIndex(void 0);else if(l.isObject(c))for(var m in c)a.dataIndex(l.observable.getIndex(b,j)),a.pushContext(c[m]),g+=i.renderChildren(a),a.popContext(),a.dataIndex(void 0),j++;this.html(g+e.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};for(var d,e="$this",f=Z.Create("{{"+(c.text||e)+"}}"),g=Z.Create("{{"+(c.value||e)+"}}","value"),h=l.isString(c.caption)&&new m("option"),i=new m("option"),j=this._children,k=0;k<j.length;k++)d=j[k],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(k--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,this._children.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,this.addChild(h)),l.queries.each.preprocess.call(this,a,b)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each&&!this._sync)throw new Error("render() is supported only() in each context");this._renderMode=a.value?m.RenderMode.All:m.RenderMode.None,a.containsObservable&&this._renderMode==m.RenderMode.None&&(this._renderMode=m.RenderMode.ElementOnly,this.css("display","none"),T.data(this,"renderCache",this))},update:function(a){var b=T.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(l.domQuery(this)),l.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){T.data(this).updateOn=a}},animate:{preprocess:function(a){T.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=T.data(this).virtual;c._each&&(c=m(),c._el=this),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:l.noop,update:function(a){a&&this.focus()}},on:{ready:function(a,b,c){if(a&&b){b=l.toArray(b);var d=this,e=function(a){var d=l.context(this),e=d.$template||d.$view||d.$root;l.each(b,function(b){b.call(e,a,c)})};a=l.isArray(a)?a:a.toString().split(" "),l.each(a,function(a){f(d,a,e)})}}}}),l.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){l.queries[a]={passRawValues:!0,ready:function(b,c){l.queries.on.ready.call(this,a,b,c)}}});var ea="__blocks.observable__";C.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable.__value__.length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=T.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable.__value__.length);return b=l.isNaN(e)||e===1/0?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;c>f;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){aa.insert(a,this.chunkLength(a)*b+this.startIndex,l.isArray(c)?c:[c])},remove:function(a,b){var c=this;this.each(function(d){l.context(d).childs.splice(a,b);for(var e=0;b>e;e++)c._removeAt(d,a)}),T.collectGarbage(),this.dispose(),this.observable._indexes.splice(a,b)},add:function(a,b){var c=this,d=this.observable;l.each(a,function(a,c){d._indexes.splice(b+c,0,l.observable(b+c))}),this.each(function(e,f){var g,h=l.domQuery(e),i=l.context(e),j="";if(h.contextBubble(i,function(){g=h.getSyncIndex();for(var c=0;c<a.length;c++)h.dataIndex(l.observable.getIndex(d,c+b,!0)),i.childs.splice(c+b,0,h.pushContext(a[c])),j+=f.renderChildren(h,g+(c+b)),h.popContext(),h.dataIndex(void 0)}),0===e.childNodes.length)W.html(e,j),h.createElementObservableDependencies(e.childNodes);else{var k=h.createFragment(j);c.insertAt(e,b,k)}}),this.dispose()},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=T.data(d.elementId).dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=T.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=T.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}},_removeAt:function(a,b){var c=this.chunkLength(a);aa.remove(a,c*b+this.startIndex,c)}};var fa=1;l.observable=function(a,b){var c=function(a){0===arguments.length&&G.trigger(c,"get",c);var b=F(c),d=c.update;return 0===arguments.length?(Y.registerObservable(c),b):(l.equals(a,b,!1)||G.trigger(c,"changing",a,b)===!1||(c.update=l.noop,c._dependencyType?2==c._dependencyType&&c.__value__.set.call(c.__context__,a):l.isArray(b)&&l.isArray(a)&&c.reset?c.reset(a):c.__value__=a,c.update=d,c.update(),G.trigger(c,"change",a,b)),c)};return a=l.unwrap(a),l.extend(c,l.observable.fn.base),c.__id__=fa++,c.__value__=a,c.__context__=b||l.__viewInInitialize__||c,c._expressionKeys={},c._expressions=[],c._elementKeys={},c._elements=[],l.isArray(a)?(l.extend(c,l.observable.fn.array),c._indexes=[],c._chunkManager=new C(c)):l.isFunction(a)?c._dependencyType=1:a&&l.isFunction(a.get)&&l.isFunction(a.set)&&(c._dependencyType=2),D(c),c};var ga={};l.extend(l.observable,{getIndex:function(a,b,c){if(!l.isObservable(a))return ga[b]||(ga[b]=l.observable(b)),ga[b];var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=l.observable(b),e.splice(b,0,d)):d=l.observable(b),d},fn:{base:{__identity__:ea,update:function(){var a,b,c,d,e,f,g=this._elements;l.eachRight(this._expressions,function(b){d=b.element,c=b.context,d||(a=T.data(b.elementId),d=b.element=a.dom);try{f=l.unwrap(X[b.expression](c))}catch(g){f=""}f=null==f?"":f.toString(),e=b.length-f.length,b.length=f.length,d?b.attr?d.setAttribute(b.attr,Z.GetValue(c,null,b.entire)):d.nextSibling?(d=d.nextSibling,d.nodeValue=f+d.nodeValue.substring(b.length+e)):d.parentNode.appendChild(document.createTextNode(f)):(d=a.virtual,b.attr&&d.attr(b.attr,Z.GetValue(c,null,b.entire)))});for(var h=0;h<g.length;h++)f=g[h],d=f.element,!d&&T.data(f.elementId)&&(d=f.element=T.data(f.elementId).dom,d||(d=T.data(f.elementId).virtual)),m.Is(d)||document.body.contains(d)?(b=l.domQuery(d),b.contextBubble(f.context,function(){b.executeMethods(d,f.cache)})):(g.splice(h,1),h-=1);return l.each(this._dependencies,function(a){D(a),a.update()}),l.each(this._indexes,function(a,b){a(b)}),this},on:function(a,b,c){return G.on(this,a,b,c||this.__context__),this},once:function(a,b,c){return G.once(this,a,b,c||this.__context__),this},off:function(a,b){return G.off(this,a,b),this},extend:function(a){var b,c=l.observable[a];return 0===arguments.length?(l.core.expressionsCreated&&l.core.applyExpressions(l.type(this()),this),this):c?(b=c.apply(this,l.toArray(arguments).slice(1)),l.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return l.observable(a?l.clone(b):b,this.__context__)},toString:function(){var a=this.__context__,b=1==this._dependencyType?this.__value__.call(a):2==this._dependencyType?this.__value__.get.call(a):this.__value__;return Y.registerObservable(this),null!=b&&l.isFunction(b.toString)?b.toString():String(b)}},array:{reset:function(a){if(0===arguments.length)return this.removeAll(),this;a=l.unwrap(a);var b=this.__value__,c=this._chunkManager,d=Math.max(a.length-b.length,0),e=Math.max(b.length-a.length,0),f=a.length-d;return G.trigger(this,"removing",{type:"removing",items:b,index:0}),G.trigger(this,"adding",{type:"adding",items:a,index:0}),c.each(function(b,c){var d=l.domQuery(b);d.contextBubble(l.context(b),function(){c.updateChildren(a,f,d,b)})}),d>0?c.add(a.slice(b.length),b.length):e>0&&c.remove(a.length,e),this.__value__=a,G.trigger(this,"remove",{type:"remove",items:b,index:0}),G.trigger(this,"add",{type:"add",items:a,index:0}),this},add:function(a,b){return this.splice(l.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[l.isNumber(b)?b:this.__value__.length,0].concat(l.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return l.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,c){var d,e,f=this.__value__,g=this._chunkManager;if(0===arguments.length)(G.has(this,"removing")||G.has(this,"remove"))&&(d=l.clone(f)),G.trigger(this,"removing",{type:"removing",items:d,index:0}),g.remove(0,f.length),this._indexes=[],d=f.splice(0,f.length),G.trigger(this,"remove",{type:"remove",items:d,index:0});else{var h,i=l.isFunction(a);for(e=0;e<f.length&&(h=f[e],!(h===a||i&&a.call(b,h,e,f))||(this.splice(e,1),e-=1,!c));e++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,l.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(arguments),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;e>i;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):c>b?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;e>i;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var c,d=this.__value__,e=this._chunkManager,f=[],g=arguments;return a=0>a?d.length-a:a,b&&a<d.length&&a>=0&&(b=Math.min(d.length-a,b),f=d.slice(a,a+b),G.trigger(this,"removing",{type:"removing",items:f,index:a}),e.remove(a,b),f=d.splice(a,b),G.trigger(this,"remove",{type:"remove",items:f,index:a})),g.length>2&&(c=l.toArray(g),c.splice(0,2),G.trigger(this,"adding",{type:"adding",index:a,items:c}),e.add(c,a),d.splice.apply(d,[a,0].concat(c)),G.trigger(this,"add",{type:"add",index:a,items:c})),this.update(),f},unshift:function(){return this.addMany(arguments,0),this.__value__.length}}}});var ha={waiting:{},initExpressionExtender:function(a){var b=a.clone();return b.view=l.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=l.bind(ha.updateObservable,b),b._operations=a._operations?l.clone(a._operations):[],b._getter=l.bind(ha.getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ha.executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ha.executeOperations(b))}),b},getter:function(){G.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,ha.executeOperationsPure(this)},updateObservable:function(){ha.executeOperations(this)},executeOperationsPure:function(a){var b=[],c=a.view._observed,d=a.view._updateObservable;l.each(c,function(a){G.off(a,"change",d)}),c=a.view._observed=[],Y.startObserving(),l.each(a._operations,function(c){if("step"==c.type){var d=a.view;a.view=l.observable([]),a.view._connections={},b.length&&ha.executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=d}else b.push(c)}),b.length&&ha.executeOperationsChunk(a,b),l.each(Y.stopObserving(),function(a){c.push(a),a.on("change",d)})},executeOperations:function(a){var b=a.__id__,c=ha.waiting;c[b]||(c[b]=!0,setTimeout(function(){ha.executeOperationsPure(a),c[b]=!1},0))},executeOperationsChunk:function(a,b){var c="add",d="remove",e="exists",f=e,g=a.__value__,h=a.view,i=h._connections,j={},k=0,m=h.update,n=0,o=g.length;h.update=l.noop,l.each(b,function(c){"skip"==c.type?(n=c.skip,l.isFunction(n)&&(n=n.call(a.__context__)),n=l.unwrap(n)):"take"==c.type?(o=c.take,l.isFunction(o)&&(o=o.call(a.__context__)),o=l.unwrap(o)):"sort"==c.type&&(g=l.isString(c.sort)?l.clone(g).sort(function(a,b){return a[c.sort]-b[c.sort]}):l.isFunction(c.sort)?l.clone(g).sort(c.sort):l.clone(g).sort(),1==b.length&&b.push({type:"filter",filter:function(){return!0}}))}),l.each(g,function(m,p){if(0>=o){for(;h().length-k>0;)h.removeAt(h().length-1);return!1}switch(l.each(b,function(b){var h=b.filter;if(f=void 0,h){if(!h.call(a.__context__,m,p,g))return f=void 0,void 0!==i[p]&&(f=d),!1;f=e,void 0===i[p]&&(f=c)}else if("skip"==b.type){if(f=e,n-=1,n>=0)return f=d,!1;0>n&&void 0===i[p]&&(f=c)}else if("take"==b.type){if(0>=o)return f=d,!1;o-=1,f=e,void 0===i[p]&&(f=c)}}),f){case c:j[p]=k,h.splice(k,0,m),k++;break;case d:h.removeAt(k);break;case e:j[p]=k,k++}}),h._connections=j,h.update=m,h.update()}};l.observable.filter=function(a){var b=ha.initExpressionExtender(this),c=a;return(!l.isFunction(c)||l.isObservable(c))&&(c=function(b){var c=l.unwrap(a),d=String(c).toLowerCase();return b=String(l.unwrap(b)).toLowerCase(),!c||-1!=b.indexOf(d)}),b._operations.push({type:"filter",filter:c}),b},l.observable.step=function(a){var b=ha.initExpressionExtender(this);return b._operations.push({type:"step",step:a}),b},l.observable.skip=function(a){var b=ha.initExpressionExtender(this);return b._operations.push({type:"skip",skip:a}),b},l.observable.take=function(a){var b=ha.initExpressionExtender(this);return b._operations.push({type:"take",take:a}),b},l.observable.sort=function(a){var b=ha.initExpressionExtender(this);return b._operations.push({type:"sort",sort:a}),b},l.query=function(a,b){l.domReady(function(){l.$unwrap(b,function(b){l.isElement(b)||(b=document.body);var c=new A,d=v(b)[0],e=window.__blocksServerData__;c.pushContext(a),c._serverData=e,e?d.render(c):d.sync(c),c.createElementObservableDependencies([b])})})},l.executeQuery=function(a,b){var c=m.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=l.queries[b];e.passDomQuery&&d.unshift(l.domQuery(a)),e[c].apply(a,d)},l.context=function(a,b){if(a=l.$unwrap(a)){var c=T.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return l.context(m.Is(a)?a._parent:a.parentNode,!0)}return null},l.dataItem=function(a){var b=l.context(a);return b?b.$this:null},l.isObservable=function(a){return!!a&&a.__identity__===ea},l.unwrapObservable=function(a){return a&&a.__identity__===ea?a():a},l.domQuery=function(a){if(a=l.$unwrap(a)){var b=T.data(a,"domQuery");return b?b:l.domQuery(m.Is(a)?a._parent:a.parentNode)}return null}}()}(),function(){var a=l.toString;l.toString=function(b){return 0===arguments.length?"jsblocks - Better MV-ish Framework":a(b)}}();var o=a.blocks;return l.noConflict=function(b){return a.blocks===l&&(a.blocks=o),b&&a.blocks===l&&(a.blocks=o),l},"function"==typeof define&&define.amd&&define("blocks",[],function(){return l}),b!==!0&&(a.blocks=l),l});
//# sourceMappingURL=blocks-query-data.min.js.map